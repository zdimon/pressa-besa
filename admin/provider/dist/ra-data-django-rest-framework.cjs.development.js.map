{"version":3,"file":"ra-data-django-rest-framework.cjs.development.js","sources":["../src/tokenAuthProvider.ts","../src/index.ts"],"sourcesContent":["import { AuthProvider, fetchUtils } from 'ra-core';\n\nexport interface Options {\n  obtainAuthTokenUrl?: string;\n}\n\nfunction tokenAuthProvider(options: Options = {}): AuthProvider {\n  const opts = {\n    obtainAuthTokenUrl: '/api-token-auth/',\n    ...options,\n  };\n  return {\n    login: async ({ username, password }) => {\n      const request = new Request(opts.obtainAuthTokenUrl, {\n        method: 'POST',\n        body: JSON.stringify({ username, password }),\n        headers: new Headers({ 'Content-Type': 'application/json' }),\n      });\n      const response = await fetch(request);\n      if (response.ok) {\n        localStorage.setItem('token', (await response.json()).token);\n        return;\n      }\n      if (response.headers.get('content-type') !== 'application/json') {\n        throw new Error(response.statusText);\n      }\n\n      const json = await response.json();\n      const error = json.non_field_errors;\n      throw new Error(error || response.statusText);\n    },\n    logout: () => {\n      localStorage.removeItem('token');\n      return Promise.resolve();\n    },\n    checkAuth: () =>\n      localStorage.getItem('token') ? Promise.resolve() : Promise.reject(),\n    checkError: error => {\n      const status = error.status;\n      if (status === 401 || status === 403) {\n        localStorage.removeItem('token');\n        return Promise.reject();\n      }\n      return Promise.resolve();\n    },\n    getPermissions: () => {\n      return Promise.resolve();\n    },\n  };\n}\n\nexport function createOptionsFromToken() {\n  const token = localStorage.getItem('token');\n  if (!token) {\n    return {};\n  }\n  return {\n    user: {\n      authenticated: true,\n      token: 'Token ' + token,\n    },\n  };\n}\n\nexport function fetchJsonWithAuthToken(url: string, options: object) {\n  return fetchUtils.fetchJson(\n    url,\n    Object.assign(createOptionsFromToken(), options)\n  );\n}\n\nexport default tokenAuthProvider;\n","import { stringify } from 'query-string';\nimport {\n  Identifier,\n  Pagination,\n  Sort,\n  Filter,\n  fetchUtils,\n  DataProvider,\n} from 'ra-core';\n\nexport {\n  default as tokenAuthProvider,\n  fetchJsonWithAuthToken,\n} from './tokenAuthProvider';\n\nconst getPaginationQuery = (pagination: Pagination) => {\n  return {\n    page: pagination.page,\n    page_size: pagination.perPage,\n  };\n};\n\nconst getFilterQuery = (filter: Filter) => {\n  const { q: search, ...otherSearchParams } = filter;\n  return {\n    ...otherSearchParams,\n    search,\n  };\n};\n\nexport const getOrderingQuery = (sort: Sort) => {\n  const { field, order } = sort;\n  return {\n    ordering: `${order === 'ASC' ? '' : '-'}${field}`,\n  };\n};\n\nexport default (\n  apiUrl: String,\n  httpClient: Function = fetchUtils.fetchJson\n): DataProvider => {\n  const getOneJson = (resource: String, id: Identifier) =>\n    httpClient(`${apiUrl}/${resource}/${id}/`).then(\n      (response: Response) => response.json\n    );\n\n  return {\n    getList: async (resource, params) => {\n      const query = {\n        ...getFilterQuery(params.filter),\n        ...getPaginationQuery(params.pagination),\n        ...getOrderingQuery(params.sort),\n      };\n      const url = `${apiUrl}/${resource}/?${stringify(query)}`;\n\n      const { json } = await httpClient(url);\n\n      return {\n        data: json.results,\n        total: json.count,\n      };\n    },\n\n    getOne: async (resource, params) => {\n      const data = await getOneJson(resource, params.id);\n      return {\n        data,\n      };\n    },\n\n    getMany: (resource, params) => {\n      return Promise.all(\n        params.ids.map(id => getOneJson(resource, id))\n      ).then(data => ({ data }));\n    },\n\n    getManyReference: async (resource, params) => {\n      const query = {\n        ...getFilterQuery(params.filter),\n        ...getPaginationQuery(params.pagination),\n        ...getOrderingQuery(params.sort),\n        [params.target]: params.id,\n      };\n      const url = `${apiUrl}/${resource}/?${stringify(query)}`;\n\n      const { json } = await httpClient(url);\n      return {\n        data: json.results,\n        total: json.count,\n      };\n    },\n\n    update: async (resource, params) => {\n      const { json } = await httpClient(`${apiUrl}/${resource}/${params.id}/`, {\n        method: 'PATCH',\n        body: JSON.stringify(params.data),\n      });\n      return { data: json };\n    },\n\n    updateMany: (resource, params) =>\n      Promise.all(\n        params.ids.map(id =>\n          httpClient(`${apiUrl}/${resource}/${id}/`, {\n            method: 'PATCH',\n            body: JSON.stringify(params.data),\n          })\n        )\n      ).then(responses => ({ data: responses.map(({ json }) => json.id) })),\n\n    create: async (resource, params) => {\n      const { json } = await httpClient(`${apiUrl}/${resource}/`, {\n        method: 'POST',\n        body: JSON.stringify(params.data),\n      });\n      return {\n        data: { ...json },\n      };\n    },\n\n    delete: (resource, params) =>\n      httpClient(`${apiUrl}/${resource}/${params.id}/`, {\n        method: 'DELETE',\n      }).then(() => ({ data: params.previousData })),\n\n    deleteMany: (resource, params) =>\n      Promise.all(\n        params.ids.map(id =>\n          httpClient(`${apiUrl}/${resource}/${id}/`, {\n            method: 'DELETE',\n          })\n        )\n      ).then(responses => ({ data: responses.map(({ json }) => json.id) })),\n  };\n};\n"],"names":["tokenAuthProvider","options","opts","obtainAuthTokenUrl","login","username","password","request","Request","method","body","JSON","stringify","headers","Headers","fetch","response","get","Error","statusText","json","error","non_field_errors","ok","localStorage","setItem","token","logout","removeItem","Promise","resolve","checkAuth","getItem","reject","checkError","status","getPermissions","createOptionsFromToken","user","authenticated","fetchJsonWithAuthToken","url","fetchUtils","fetchJson","Object","assign","getPaginationQuery","pagination","page","page_size","perPage","getFilterQuery","filter","search","q","otherSearchParams","getOrderingQuery","sort","field","order","ordering","apiUrl","httpClient","getOneJson","resource","id","then","getList","params","query","data","results","total","count","getOne","getMany","all","ids","map","getManyReference","target","update","updateMany","responses","create","delete","previousData","deleteMany"],"mappings":"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"}