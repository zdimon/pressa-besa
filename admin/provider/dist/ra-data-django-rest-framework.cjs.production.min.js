"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("query-string"),t=require("ra-core");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var n=function(e){return{page:e.page,page_size:e.perPage}},o=function(e){var t=e.q;return r(r({},function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t.indexOf(r=i[n])>=0||(o[r]=e[r]);return o}(e,["q"])),{},{search:t})},i=function(e){return{ordering:("ASC"===e.order?"":"-")+e.field}};exports.default=function(u,a){void 0===a&&(a=t.fetchUtils.fetchJson);var s=function(e,t){return a(u+"/"+e+"/"+t+"/").then((function(e){return e.json}))};return{getList:function(t,s){try{var c=r(r(r({},o(s.filter)),n(s.pagination)),i(s.sort)),f=u+"/"+t+"/?"+e.stringify(c);return Promise.resolve(a(f)).then((function(e){var t=e.json;return{data:t.results,total:t.count}}))}catch(e){return Promise.reject(e)}},getOne:function(e,t){try{return Promise.resolve(s(e,t.id)).then((function(e){return{data:e}}))}catch(e){return Promise.reject(e)}},getMany:function(e,t){return Promise.all(t.ids.map((function(t){return s(e,t)}))).then((function(e){return{data:e}}))},getManyReference:function(t,s){try{var c,f=r(r(r(r({},o(s.filter)),n(s.pagination)),i(s.sort)),{},((c={})[s.target]=s.id,c)),l=u+"/"+t+"/?"+e.stringify(f);return Promise.resolve(a(l)).then((function(e){var t=e.json;return{data:t.results,total:t.count}}))}catch(e){return Promise.reject(e)}},update:function(e,t){try{return Promise.resolve(a(u+"/"+e+"/"+t.id+"/",{method:"PATCH",body:JSON.stringify(t.data)})).then((function(e){return{data:e.json}}))}catch(e){return Promise.reject(e)}},updateMany:function(e,t){return Promise.all(t.ids.map((function(r){return a(u+"/"+e+"/"+r+"/",{method:"PATCH",body:JSON.stringify(t.data)})}))).then((function(e){return{data:e.map((function(e){return e.json.id}))}}))},create:function(e,t){try{return Promise.resolve(a(u+"/"+e+"/",{method:"POST",body:JSON.stringify(t.data)})).then((function(e){return{data:r({},e.json)}}))}catch(e){return Promise.reject(e)}},delete:function(e,t){return a(u+"/"+e+"/"+t.id+"/",{method:"DELETE"}).then((function(){return{data:t.previousData}}))},deleteMany:function(e,t){return Promise.all(t.ids.map((function(t){return a(u+"/"+e+"/"+t+"/",{method:"DELETE"})}))).then((function(e){return{data:e.map((function(e){return e.json.id}))}}))}}},exports.fetchJsonWithAuthToken=function(e,r){return t.fetchUtils.fetchJson(e,Object.assign((n=localStorage.getItem("token"))?{user:{authenticated:!0,token:"Token "+n}}:{},r));var n},exports.getOrderingQuery=i,exports.tokenAuthProvider=function(e){void 0===e&&(e={});var t=r({obtainAuthTokenUrl:"/api-token-auth/"},e);return{login:function(e){var r=e.username,n=e.password;try{var o=new Request(t.obtainAuthTokenUrl,{method:"POST",body:JSON.stringify({username:r,password:n}),headers:new Headers({"Content-Type":"application/json"})});return Promise.resolve(fetch(o)).then((function(e){var t=!1;function r(r){if(t)return r;if("application/json"!==e.headers.get("content-type"))throw new Error(e.statusText);return Promise.resolve(e.json()).then((function(t){throw new Error(t.non_field_errors||e.statusText)}))}var n=function(){if(e.ok){var r=localStorage,n=r.setItem;return Promise.resolve(e.json()).then((function(e){n.call(r,"token",e.token),t=!0}))}}();return n&&n.then?n.then(r):r(n)}))}catch(e){return Promise.reject(e)}},logout:function(){return localStorage.removeItem("token"),Promise.resolve()},checkAuth:function(){return localStorage.getItem("token")?Promise.resolve():Promise.reject()},checkError:function(e){var t=e.status;return 401===t||403===t?(localStorage.removeItem("token"),Promise.reject()):Promise.resolve()},getPermissions:function(){return Promise.resolve()}}};
//# sourceMappingURL=ra-data-django-rest-framework.cjs.production.min.js.map
